<!-- Path: force-app/main/default/lwc/deprecationScanner/deprecationScanner.html -->
<template>
    <lightning-card title="Salesforce Deprecation Scanner" icon-name="utility:search">
        
        <!-- Header with Statistics -->
        <div slot="actions" if:true={statistics.totalRules}>
            <lightning-badge label={statistics.totalRules} class="slds-m-right_small"></lightning-badge>
            <span class="slds-text-body_small slds-text-color_weak">Detection Rules</span>
        </div>
        
        <!-- Tab Navigation -->
        <div class="slds-p-horizontal_medium slds-p-top_medium">
            <lightning-tabset active-tab-value={activeTab} onactive={handleTabChange}>
                
                <!-- Scan Tab -->
                <lightning-tab label="Scan Repository" value="scan">
                    <div class="slds-p-around_medium">
                        
                        <!-- Repository URL Input -->
                        <lightning-input
                            type="url"
                            label="GitHub Repository URL"
                            placeholder="https://github.com/owner/repository"
                            value={repositoryUrl}
                            onchange={handleUrlChange}
                            class="slds-m-bottom_small"
                            required>
                        </lightning-input>
                        
                        <!-- URL Validation Message -->
                        <template if:true={urlValidation.message}>
                            <div class="slds-m-bottom_medium">
                                <div class={containerClass}>
                                    <lightning-icon 
                                        icon-name={iconName}
                                        size="xx-small"
                                        class="slds-m-right_xx-small">
                                    </lightning-icon>
                                    {urlValidation.message}
                                </div>
                            </div>
                        </template>
                        
                        <!-- Scan Button -->
                        <lightning-button
                            variant="brand"
                            label={scanButtonLabel}
                            onclick={handleScan}
                            disabled={isScanDisabled}
                            class="slds-m-right_small">
                        </lightning-button>
                        
                        <!-- Help Text -->
                        <div class="slds-m-top_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">How it works:</h3>
                            <ul class="slds-list_dotted">
                                <li>Enter a public GitHub repository URL</li>
                                <li>The scanner will analyze Aura, LWC, and Apex files</li>
                                <li>Deprecated components will be identified with replacement suggestions</li>
                                <li>Get detailed reports with documentation links</li>
                            </ul>
                        </div>
                        
                    </div>
                </lightning-tab>
                
                <!-- Results Tab -->
                <lightning-tab label="Results" value="results" disabled={isResultsDisabled}>
                    <div class="slds-p-around_medium">
                        
                        <!-- Loading State -->
                        <template if:true={isScanning}>
                            <div class="slds-text-align_center slds-p-around_large">
                                <lightning-spinner alternative-text="Scanning repository..." size="medium"></lightning-spinner>
                                <p class="slds-m-top_medium">Scanning repository for deprecated components...</p>
                            </div>
                        </template>
                        
                        <!-- Results Summary -->
                        <template if:true={hasResults}>
                            <div class="slds-box slds-m-bottom_medium">
                                <div class="slds-grid slds-grid_align-spread">
                                    <div>
                                        <h2 class="slds-text-heading_small">{scanResult.repositoryName}</h2>
                                        <p class="slds-text-body_small slds-text-color_weak">
                                            Scanned {scanResult.totalFilesScanned} files on {formatDate}
                                        </p>
                                    </div>
                                    <div class="slds-text-align_right">
                                        <lightning-button
                                            label="New Scan"
                                            onclick={handleNewScan}
                                            class="slds-m-right_small">
                                        </lightning-button>
                                        <template if:true={hasFindings}>
                                            <lightning-button
                                                label="Export Results"
                                                onclick={handleExportResults}>
                                            </lightning-button>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Summary Alert (use SLDS instead of lightning-alert) -->
                            <div class={alertClass} role="alert">
                                <h3>{findingsCount} Deprecated Components Found</h3>
                                <p>{scanSummary}</p>
                            </div>

                            <!-- No Findings -->
                            <template if:false={hasFindings}>
                                <div class="slds-text-align_center slds-p-around_large">
                                    <lightning-icon icon-name="utility:success" size="large" class="slds-m-bottom_medium"></lightning-icon>
                                    <h3 class="slds-text-heading_medium slds-text-color_success">Great Job!</h3>
                                    <p>No deprecated components found in this repository.</p>
                                </div>
                            </template>
                            
                            <!-- Findings List -->
                            <template if:true={hasFindings}>
                                <h3 class="slds-text-heading_small slds-m-bottom_medium">Findings Details</h3>
                                
                                <div class="findings-container">
                                    <template for:each={findings} for:item="finding" for:index="index">
                                        <div key={finding.filePath} 
                                             class="slds-box slds-m-bottom_small finding-item"
                                             data-index={index}
                                             onclick={handleFindingClick}>
                                            
                                            <div class="slds-grid slds-grid_align-spread">
                                                <div class="slds-size_8-of-12">
                                                    <div class="slds-grid slds-grid_vertical-align-center">
                                                        <lightning-icon 
                                                            icon-name={getSeverityIcon}
                                                            size="small"
                                                            class={getSeverityClass}>
                                                        </lightning-icon>
                                                        <div class="slds-m-left_small">
                                                            <h4 class="slds-text-heading_x-small">{finding.deprecatedComponent}</h4>
                                                            <p class="slds-text-body_small slds-text-color_weak">
                                                                {finding.fileName} (Line {finding.lineNumber})
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-size_4-of-12 slds-text-align_right">
                                                    <lightning-badge label={finding.severity} variant={severityVariant}></lightning-badge>
                                                    <p class="slds-text-body_small slds-m-top_xx-small">
                                                        {finding.componentType}
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <div class="slds-m-top_small">
                                                <p class="slds-text-body_small">{finding.description}</p>
                                                <div class="slds-m-top_xx-small">
                                                    <strong class="slds-text-color_success">Recommended: </strong>
                                                    <span>{finding.recommendedReplacement}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </template>
                    </div>
                </lightning-tab>
                
                <!-- Statistics Tab -->
                <!-- unchanged except formatting -->
            </lightning-tabset>
        </div>
        
        <!-- Finding Details Modal -->
        <template if:true={showDetails}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                                onclick={handleCloseDetails}>
                            <lightning-icon icon-name="utility:close" size="small"></lightning-icon>
                        </button>
                        <h2 class="slds-text-heading_medium">Deprecation Details</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium">
                        <template if:true={selectedFinding}>
                            <!-- content unchanged -->
                            <div if:true={selectedFinding.documentationUrl} class="slds-m-top_medium">
                                <lightning-button
                                    label="View Documentation"
                                    onclick={handleViewDocumentation}
                                    variant="brand">
                                </lightning-button>
                            </div>
                        </template>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        
    </lightning-card>
</template>
